<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>{{ _('My Cart') }}</title>
    <meta name="robots" content="noindex, follow" />
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="../static/images/favicon.png">

    <!-- Helper CSS -->
    <link rel="stylesheet" href="../static/css/helper.css">

    <!--====== Use the minified version files listed below for better performance and remove the files listed above ======-->
    <link rel="stylesheet" href="../static/css/plugins-min/plugins.min.css">
    <link rel="stylesheet" href="../static/css/style.min.css">


</head>

<body>

    <div class="main-wrapper">

        <!--Header Section-->
        <div class="header-section d-none d-lg-block">
            <div class="main-header">
                <div class="container position-relative">
                    <div class="row align-items-center">
                        <!--标题栏logo-->
                        <div class="col-lg-2">
                            <div class="header-logo">
                                <img src="../static/images/logo/logo.png">
                            </div>
                        </div>
                        <!--标题栏导航菜单-->
                        <div class="col-lg-7 position-static">
                            <div class="site-main-nav">
                                <nav class="site-nav">
                                    <ul>
                                        <li>
                                            <a href="{{ url_for('main.home') }}">{{ _('Home') }}</a>
                                        </li>
                                        <li>
                                            <a href="{{ url_for('main.shop_list_new', text='%null%') }}">{{ _('SHOP LIST') }}<span class="new">{{ _('New') }}</span></a>
                                        </li>
                                        <li>
                                            <a href="{{ url_for('main.about') }}">{{ _('About') }}</a>
                                        </li>
                                        <li>
                                            <a href="{{ url_for('main.blog') }}">{{ _('Blog') }}</a>
                                        </li>
                                        {% if current_user.is_authenticated %}
                                            <li>
                                                <a href="#">{{ _('My') }}</a>
                                                <ul class="sub-menu">
                                                    <li><a href="{{ url_for('main.cart') }}">{{ _('Shopping cart') }}</a></li>
                                                    <li><a href="{{ url_for('main.wishlist') }}">{{ _('Wishlist') }}</a></li>
                                                    <li><a href="{{ url_for('auth.myaccount') }}">{{ _('My Account')}}</a></li>
                                                    <li><a href="{{ url_for('main.collection_card') }}">{{ _('Collection') }}</a></li>
                                                </ul>
                                            </li>
                                        {% endif %}
                                    </ul>
                                </nav>
                            </div>
                        </div>
                        <!--标题栏右菜单-->
                        <div class="col-lg-3">
                            <div class="header-meta-info">
                                <!--搜索-->
                                <div class="header-search">
                                    <form action="#">
                                        <input type="text" class="search_input" placeholder="Search">
                                        <button type="button" class="search_button"><i class="icon-search"></i></button>
                                    </form>
                                </div>
                                <!--用户-->
                                <div class="header-account">
                                    <!--小人图标-->
                                    <div class="header-account-list dropdown top-link">
                                        <a href="#" role="button" data-toggle="dropdown"><i class="icon-users"></i></a>
                                        <ul class="dropdown-menu ">
                                            {% if current_user.is_authenticated %}
                                                {% if isAdmin %}
                                                    <li><a href="{{ url_for('admin.admin_main') }}">{{ _('My shop') }}</a></li>
                                                    <li><a href="{{ url_for('auth.logout') }}">{{ _('Log out') }}</a></li>
                                                {% else %}
                                                    <li><a href="{{ url_for('auth.myaccount') }}">{{ _('My account') }}</a></li>
                                                    <li><a href="{{ url_for('auth.logout') }}">{{ _('Log out') }}</a></li>
                                                {% endif %}
                                            {% else %}
                                                <li><a href="{{ url_for('auth.login') }}">{{ _('Login') }}</a></li>
                                                <li><a href="{{ url_for('auth.register') }}">{{ _('Register') }}</a></li>
                                            {% endif %}
                                        </ul>
                                    </div>

                                    <div class="header-account-list dropdown top-link" style="margin-left: 27px">
                                        <a href="#" role="button" data-toggle="dropdown" style="width: 25px"><img src="../static/images/switch.png"></a>
                                        <ul class="dropdown-menu ">
                                            <li><a href="#">English</a></li>
                                            <li><a href="#">中文</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--Header Mobile-->
        <div class="header-mobile d-lg-none">
            <div class="container">
                <div class="row align-items-center">
                    <!--导航栏logo-->
                    <div class="col-6">
                        <div class="header-logo">
                            <img src="../static/images/logo/logo.png" alt="">
                        </div>
                    </div>
                    <!--导航栏内容-->
                    <div class="col-6">
                        <div class="header-meta-info">
                            <div class="header-account">
                                <!--用户图标-->
                                <div class="header-account-list dropdown top-link">
                                    <a href="#" role="button" data-toggle="dropdown"><i class="icon-users"></i></a>
                                    <ul class="dropdown-menu ">
                                        {% if current_user.is_authenticated %}
                                            {% if isAdmin %}
                                                <li><a href="{{ url_for('admin.shop') }}">My shop</a></li>
                                                <li><a href="{{ url_for('auth.logout') }}">Log out</a></li>
                                            {% else %}
                                                <li><a href="{{ url_for('auth.myaccount') }}">My account</a></li>
                                                <li><a href="{{ url_for('auth.logout') }}">Log out</a></li>
                                            {% endif %}
                                        {% else %}
                                            <li><a href="{{ url_for('auth.login') }}">Login</a></li>
                                            <li><a href="{{ url_for('auth.register') }}">Register</a></li>
                                        {% endif %}
                                    </ul>
                                </div>
                                <div class="header-account-list dropdown mini-cart" style="margin-left: 27px">
                                        <a href="#" role="button" data-toggle="dropdown" style="width: 25px"><img src="../static/images/switch.png"></a>
                                        <ul class="dropdown-menu ">
                                            <li><a href="#">English</a></li>
                                            <li><a href="#">Chinese</a></li>
                                        </ul>
                                    </div>

                                <!--菜单展开图标-->
                                <div class="header-account-list mobile-menu-trigger">
                                    <button id="menu-trigger">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--Header Mobile Menu-->
        <div class="header-mobile-menu d-lg-none">

            <!--侧边栏关闭图标-->
            <a href="javascript:void(0)" class="mobile-menu-close">
                <span></span>
                <span></span>
            </a>

            <!--侧边栏搜索部分-->
            <div class="header-meta-info">
                <!--搜索-->
                <div class="header-search">
                    <form action="#">
                        <input type="text" placeholder="Search our store ">
                        <button><i class="icon-search"></i></button>
                    </form>
                </div>
            </div>

            <!--侧边栏内容部分-->
            <div class="site-main-nav">
                <nav class="site-nav">
                    <ul class="navbar-mobile-wrapper">
                        <li>
                            <a href="{{ url_for('main.home') }}">Home</a>
                        </li>
                        <li>
                            <a href="#">Shop <span class="new">New</span></a>
                            <ul class="mega-sub-menu">
                                <li><a href="{{ url_for('main.shop_list_new', text='%null%') }}">Flower Zone</a></li>
                                <li><a href="{{ url_for('main.shop_list_new', text='%null%') }}">Dried Flowers Zone</a></li>
                                <li><a href="{{ url_for('main.shop_list_new', text='%null%') }}">Potted Zone</a></li>
                                <li><a href="{{ url_for('main.shop_list_new', text='%null%') }}">Tools Zone</a></li>
                                <li><a href="{{ url_for('main.shop_list_new', text='%null%') }}">Flower Suit Zone</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#">My</a>
                            <ul class="sub-menu">
                                <li><a href="{{ url_for('main.cart') }}">Shopping cart</a></li>
                                <li><a href="{{ url_for('main.wishlist') }}">Wishlist</a></li>
                                <li><a href="{{ url_for('main.checkout') }}">Checkout</a></li>
                                <li><a href="{{ url_for('auth.myaccount') }}">My Account</a></li>
                                <li><a href="#">Delivery</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="{{ url_for('main.about') }}">About</a>
                        </li>
                    </ul>
                </nav>
            </div>

            <!--侧边栏第三方连接部分-->
        {#    <div class="header-social">#}
        {#        <ul class="social">#}
        {#            <li><a href="#"><i class="fa fa-facebook"></i></a></li>#}
        {#            <li><a href="#"><i class="fa fa-twitter"></i></a></li>#}
        {#            <li><a href="#"><i class="fa fa-instagram"></i></a></li>#}
        {#            <li><a href="#"><i class="fa fa-linkedin"></i></a></li>#}
        {#            <li><a href="#"><i class="fa fa-pinterest"></i></a></li>#}
        {#        </ul>#}
        {#    </div>#}

        </div>

        <!--Overlay-->
        <div class="overlay"></div>

        <!--Page Banner-->
        {% if items != [] %}
            <div class="page-banner" style="padding-bottom: 0; padding-top: 20px">
                <div class="container">
                    <div class="page-banner-content text-center">
                        <h2 class="title">Shopping Cart</h2>
                    </div>
                </div>
            </div>
        {% endif %}


        <!--Cart-->
        {% if items == [] %}
            <div class="empty-cart-page section-padding-5">
                <div class="container">
                    <div class="empty-cart-content text-center">
                        <h2 class="empty-cart-title">Shopping Cart</h2>
                        <div class="empty-cart-img">
                            <img src="../static/images/cart.png" alt="">
                        </div>
                        <p>Your cart is currently empty!</p>
                        <a href="{{ url_for('main.shop_list_new', text='%null%') }}" class="btn btn-primary"><i class="fa fa-angle-left"></i> Go To Shopping</a>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="cart-page section-padding-5">
                <div class="container">
                    <div class="cart-table table-responsive">
                        <table class="table" id="cnm">
                            <thead>
                                <tr>
                                    <th class="image">Image</th>
                                    <th class="product">Product</th>
                                    <th class="price">Price</th>
                                    <th class="quantity">Quantity</th>
                                    <th class="total">Total</th>
                                    <th class="remove">Remove</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for i in items %}
                                    {% if i.flower_cart.on_sale %}
                                    <tr>
                                        <td class="image">
                                            <img src="../static/uploaded_AVATAR/{{ i.flower_cart.pic }}" alt="">
                                        </td>
                                        <td class="product">
                                            <a href="#" id="{{ i.id }}">{{ i.flower_cart.name }}</a>
                                        </td>
                                        <td class="price">
                                            <span class="amount" id="per_price">{{ i.flower_cart.price }}</span>
                                        </td>
                                        <td class="quantity">
                                            <form action="#">
                                                <div class="quantity d-inline-flex">
                                                    <button type="button" class="sub" ><i class="ti-minus" id="count_price"></i></button>
                                                    <input type="text" value="{{ i.number }}" name="quantity" class="quantityNumber"/>
                                                    <button type="button" class="add"><i class="ti-plus" id="count_price"></i></button>
                                                </div>
                                            </form>
                                        </td>
                                        <td class="total">
                                            <span class="total-amount" id="total">${{ i.flower_cart.price * i.number }}</span>
                                        </td>
                                        <td class="remove">
                                            <a href="{{ url_for('main.delete_cart', id=i.flower_cart.id) }}"><i class="ti-close"></i></a>
                                        </td>
                                    </tr>
                                    {% else %}
                                    <tr style="background-color: #b4b4b4">
                                        <td class="image">
                                            <img src="../static/uploaded_AVATAR/{{ i.flower_cart.pic }}" alt="">
                                        </td>
                                        <td class="product">
                                            <a href="#" id="{{ i.id }}" style="text-decoration: line-through">{{ i.flower_cart.name }}</a>
                                        </td>
                                        <td class="price">
                                            <span class="amount" id="per_price" style="text-decoration: line-through">{{ i.flower_cart.price }}</span>
                                        </td>
                                        <td class="quantity">
                                            <form action="#">
                                                <div class="quantity d-inline-flex">
{#                                                    <button type="button" class="sub" ><i class="ti-minus" id="count_price"></i></button>#}
{#                                                    <input type="text" value="{{ i.number }}" name="quantity" class="quantityNumber"/>#}
{#                                                    <button type="button" class="add"><i class="ti-plus" id="count_price"></i></button>#}
                                                    <span class="amount" style="color: red">SOLD OUT</span>
                                                </div>
                                            </form>
                                        </td>
                                        <td class="total">
                                            <span class="total-amount" id="total" style="text-decoration: line-through">${{ i.flower_cart.price * i.number }}</span>
                                        </td>
                                        <td class="remove">
                                            <a href="{{ url_for('main.delete_cart', id=i.flower_cart.id) }}"><i class="ti-close"></i></a>
                                        </td>
                                    </tr>
                                    {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="row">
                        <div class="col-lg-4" style="width: 100%; background-color: white">
                            <div class="cart-totals">
                                <div class="cart-total-table mt-25" style="background-color: white">
                                    <table class="table" style="background-color: white; text-align: center" >
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <p class="value"><b>Total</b></p>
                                                </td>
                                                <td>
                                                    <p class="price", id="total_price" style="font-size: 1.5em">${{ total }}</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="cart-total-btn">
                                    <a href="{{ url_for('main.shop_list_new', text='%null%') }}" class="btn btn-primary btn-block">Continue To Shopping</a>
                                    <button type="button" class="btn btn-primary btn-block", id="checkout">Turn To Checkout</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        {% include 'public_foot.html' %}

        <!--Back To Start-->
        <a href="#" class="back-to-top">
            <i class="fa fa-angle-double-up"></i>
        </a>

    </div>

    <!-- Modernizer JS -->
    <script src="../static/js/vendor/modernizr-3.6.0.min.js"></script>
    <!-- jQuery JS -->
    <script src="../static/js/vendor/jquery-3.3.1.min.js"></script>

    <!--====== Use the minified version files listed below for better performance and remove the files listed above ======-->
    <script src="../static/js/plugins.min.js"></script>

    <!-- Main JS -->
    <script src="../static/js/main.js"></script>

    <!-- Search -->
    <script src="../static/js/search.js"></script>


    <!-- Google Map js -->
{#    <script src="https://ditu.google.cn/maps/api/js?key=AIzaSyBQ5y0EF8dE6qwc03FcbXHJfXr4vEa7z54"></script>#}
{#    <script src="../static/js/map-script.js"></script>#}
    <script>
        Price = document.getElementById('total_price')

        $('#cnm').on('click','.sub',change)
        $('#cnm').on('click','.add',change)
        function change() {
            total = $(this).closest('tr').find('td').eq(4)
            per_price = $(this).closest('tr').find('td').eq(2).text()
            totalPrice = $(this).closest('tr').find('td').eq(3).find('.quantityNumber').val() * per_price
            total[0].innerText = '$' + totalPrice + '.0'
            Price.innerText = '$' + totalPrice + '.0'
            data = {'quantity': $(this).closest('tr').find('td').eq(3).find('.quantityNumber').val(),
                    'name': $(this).closest('tr').find('td').eq(1).text()}
            $.ajax({
                type:'post',
                url:'/test2',
                data:data,
                success:function(data){
                },
                error:function (){
                    alert('wrong')
                }
            });
        }

        $('#checkout').on('click', function (){
            if(document.getElementById('total_price').innerText == '$0'){
                $(this).css('pointer-events', 'none')
            }else{
                $.ajax({
                    type:'post',
                    url:'/lock',
                    success:function(data){
                    },
                    error:function (){
                        {#alert('wrong')#}
                    }
                });
                window.location.href = '/checkout'
            }
        })

    </script>

</body>

</html>